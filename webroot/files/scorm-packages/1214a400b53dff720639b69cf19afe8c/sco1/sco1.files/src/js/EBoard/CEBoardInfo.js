define("CEBoardInfo",["Point","Rectangle","Timer","CCompileOption","CEBoardAction","CEBoardActionElectronicBoardClearScreen","CEBoardControlPanel","CVideoPlayer","VideoAsset"],function(e,j,i,c,b,f,a,d,h){function g(p,m,l,s,k,n,u,o,r,t,q){this.PLAY=1;this.PAUSE=2;this.STOP=3;this.iID=p;this.sID=q;this.arrayEBoardAction=m;this.iControlPanelType=l;this.pointControlPanel=s;this.iShiftTime=k;this.timer=i.New(100);this.timer.addEventListener(this.EventHandlerTimerTick);this.timer.me=this;this.nMiliSecStart=this.GetCurrentMilisec();this.nMiliSecPause=0;this.iProgress=0;this.sSlideNameStart=n;this.GetSlideIndexStay();this.MediaFile=u;this.iVideoControlPannel=o;this.rectangleVideo=r;this.iPlayLoop=t;if(this.MediaFile){this.videoPlayer=new d(this.MediaFile);this.videoPlayer.bAutoPlay=true;this.videoPlayer.sSource=this.sFile;this.videoPlayer.x=this.rectangleVideo?this.rectangleVideo.x:100;this.videoPlayer.y=this.rectangleVideo?this.rectangleVideo.y:100;this.videoPlayer.width=this.rectangleVideo?this.rectangleVideo.width:400;this.videoPlayer.height=this.rectangleVideo?this.rectangleVideo.height:300;this.videoPlayer.bControlBarVisible=this.iVideoControlPannel;this.videoPlayer.iPlayType=this.iDisplayType;this.videoPlayer.iLoop=this.iDisplayType==3?1:0;this.videoPlayer.Play();this.videoPlayer.OnCreationComplete();this.ShowVideo()}this.CreateEBoardControlPanel()}g.prototype={nMiliSecPauseStart:0,bStopped:false,PLAY:1,PAUSE:2,STOP:3,CLOSE:4,videoPlayer:null,timerAction:null,nJumpTime:-1,bSaveBackground:false,bSetPos:true,SaveBackGroundImage:function(){if(this.bSaveBackground){return}this.bSaveBackground=true;var k=new j(0,0,main.iSlideWidth,main.iSlideHeight)},videoPlayerPlayheadUpdate:function(k){},videoPlayerComplete:function(k){this.Stop();if(this.iPlayLoop==2){main.GotoSlideStartNext()}},videoPlayerStateChange:function(k){},GetDuration:function(){var l;if(this.MediaFile&&this.videoPlayer&&this.videoPlayer.videoDisplay){l=this.videoPlayer.videoDisplay.duration;if(l>0){return l*1000}if(isNaN(l)){return NaN}if(l<0){return l}}var k=this.arrayEBoardAction[this.arrayEBoardAction.length-1];l=k.MSec();return l},GetEBoardArray:function(){return this.arrayEBoardAction},GetEBoardLength:function(){return this.arrayEBoardAction?this.arrayEBoardAction.length:0},GetMediaFile:function(){return this.MediaFile},IsHide:function(){return this.hided},RestoreBackground:function(){},ClearEBoard:function(){this.RestoreBackground()},CreateEBoardControlPanel:function(){switch(this.iControlPanelType){case -1:this.Start();return;case 0:this.Start();return;case 1:case 2:case 3:var l=0;if(this.arrayEBoardAction){var k=this.arrayEBoardAction[this.arrayEBoardAction.length-1];l=k.MSec()}this.eboardControlPanel=new a(this.pointControlPanel.x,this.pointControlPanel.y);this.eboardControlPanel.Init(this.timer,l,this);return}CAssertUtil.Failed()},IsRunning:function(){return this.timer.running},Status:function(){return this.iPlayStatus},ID:function(){return this.iID},Start:function(){if(this.iPlayStatus==this.PLAY){return}this.nMiliSecStart=this.GetCurrentMilisec();this.iProgress=0;this.nMiliSecPause=0;this.timer.start();this.StartAction();this.ResumeVideo();this.iPlayStatus=this.PLAY;this.bStopped=false},Pause:function(){this.nMiliSecPauseStart=this.GetCurrentMilisec();this.timer.stop();this.PauseAction();this.PauseVideo();this.iPlayStatus=this.PAUSE},Stop:function(){this.timer.stop();this.iProgress=0;this.nMiliSecPause=0;this.StopAction();this.StopVideo();this.iPlayStatus=this.STOP;this.bStopped=true},Resume:function(){if(this.iPlayStatus==this.PLAY){return}if(this.iPlayStatus==this.STOP){main.GotoSlideStart(this.sSlideNameStart);return}if(this.videoPlayer&&this.videoPlayer.videoDisplay){if(this.videoPlayer.videoDisplay.paused&&!this.videoPlayer.videoDisplay.currentTime){main.GotoSlideStart(this.sSlideNameStart);return}}if(this.iPlayStatus==this.PAUSE){this.nMiliSecPause+=this.GetCurrentMilisec()-this.nMiliSecPauseStart}else{if(this.iProgress!=0){this.nMiliSecPause+=this.GetCurrentMilisec()-this.nMiliSecPauseStart}else{this.nMiliSecStart=this.GetCurrentMilisec();this.nMiliSecPause=0}}if(this.bStopped==true){this.RestoreBackground()}this.timer.start();this.StartAction();this.ResumeVideo();this.iPlayStatus=this.PLAY;this.bStopped=false},Close:function(){this.Stop();this.StopAction();this.Hide();this.iPlayStatus=this.CLOSE},Delete:function(){main.eboardManager.Delete(this.iID)},Init:function(){this.StopAction();this.CloseAction();this.SetPosVideo(0);this.iProgress=0;this.nMiliSecStart=this.GetCurrentMilisec()-0;this.nMiliSecPause=0},StartAction:function(){if(this.iPlayStatus==this.STOP){main.ClearEBoardItem()}if(this.timerAction){this.timerAction.Start()}},PauseAction:function(){if(this.timerAction){this.timerAction.Pause()}},StopAction:function(){if(this.timerAction){this.timerAction.Stop()}},CloseAction:function(){if(this.timerAction){this.timerAction=null}},EventHandlerTimerTick:function(k){var m=this.me;var n=m.GetCurrentMilisecDiff();if(m.nJumpTime>=0){if(n-m.nJumpTime*1000>500){n=m.nJumpTime*1000}else{n=m.nJumpTime*1000;m.nJumpTime=-1}}var o=m.GetDuration();if(isNaN(o)||o<0){return}if(n>=o){m.Stop();if(m.iPlayLoop==2){main.GotoSlideStartNext()}return}if(null!=m.eboardControlPanel){m.eboardControlPanel.UpdateTime(n,o)}if(m.iProgress>=m.GetEBoardLength()){return}var l;l=m.GetCurrentEBoardAction();CAssertUtil.IsNotNull(l);if(n>l.StartSec()-m.iShiftTime){m.SaveBackGroundImage();m.timerAction=l;m.timerAction.Act((l.StartSec()-m.iShiftTime)<0?false:true,m);if(m.timerAction instanceof f==false){m.iProgress++}}},UpdateTime:function(){var k=this.GetCurrentMilisecDiff();var l=this.GetDuration();if(null!=this.eboardControlPanel){this.eboardControlPanel.UpdateTime(k,l)}},GetCurrentMilisec:function(){return new Date().getTime()},GetCurrentMilisecDiff:function(){if(this.MediaFile&&this.videoPlayer&&this.videoPlayer.videoDisplay){return this.videoPlayer.GetPlayheadTime()*1000}else{return this.GetCurrentMilisec()-this.nMiliSecStart-this.nMiliSecPause}},GetCurrentEBoardAction:function(){var k=this.arrayEBoardAction[this.iProgress];CAssertUtil.IsNotNull(k);return k},SetPos:function(k){main.ClearEBoardItem();if(this.timerAction){this.timerAction.Stop()}var n=this.iProgress;k*=1000;k=parseInt(k);var s=main.GetCurrentSlideNo();var m=0;var r=0;var l;var q;for(var o=0;o<this.GetEBoardLength();o++){l=this.arrayEBoardAction[o];q=false;if(l instanceof f&&(l.StartSec()<=k)){var t=this.arrayEBoardAction[o];if(t.iWParam==2){m+=t.wLParam;r=o+1;q=true}}if(k>=l.StartSec()&&k<=l.MSec()){this.iProgress=o;break}else{if(k<=l.StartSec()){this.iProgress=o;if(q){this.iProgress++}break}}}var p=m-(s-this.eboardStayStart);if(p){this.bSaveBackground=false}if(m==0){this.bSetPos=false}main.GotoSlideStartRelative(p,true);if(p==0){if(this.iProgress<n){this.RestoreBackground()}}for(o=r;o<this.iProgress;o++){l=this.arrayEBoardAction[o];l.Act(false,this)}this.nMiliSecStart=this.GetCurrentMilisec()-k;this.nMiliSecPause=0;this.bSetPos=true;this.SetPosVideo(k/1000)},Sync:function(l){if(this.timerAction){this.timerAction.Stop()}this.timer.stop();var p=this.eboardStayStart;var n;var o=0;for(var m=0;m<this.GetEBoardLength();m++){if(l==p){break}n=this.arrayEBoardAction[m];if(n instanceof f){var k=this.arrayEBoardAction[m];if(k.iWParam==2){p+=k.wLParam;o=k.StartSec()+1}}}this.SetPosVideo(o/1000);this.nMiliSecStart=this.GetCurrentMilisec()-o;this.nMiliSecPause=0;this.iProgress=m;if(this.iPlayStatus!=this.PAUSE){this.timer.start()}else{this.UpdateTime()}},SlideStart:function(m){var l=this.CanStay(m);var k=this.GetVisible();if(l&&k&&this.sSlideNameStart==m){l=false}this.SetVisible(l);if(l){this.Sync(main.GetCurrentSlideNo());if(!k){this.bStopped=false;this.Pause();this.Resume()}}else{}},CanStay:function(l){var k=main.GetSlideIndex(l)+1;if(k>=this.eboardStayFrom&&k<=this.eboardStayTo){return true}else{return false}},GetSlideIndexStay:function(){var l=main.GetCurrentSlideNo();this.eboardStayStart=this.eboardStayFrom=this.eboardStayTo=l;for(var n=0;n<this.GetEBoardLength();n++){var m=this.arrayEBoardAction[n];if(m instanceof f){var k=this.arrayEBoardAction[n];if(k.iWParam==2){l+=k.wLParam;if(l<this.eboardStayFrom){this.eboardStayFrom=l}if(l>this.eboardStayTo){this.eboardStayTo=l}}}}},GetVisible:function(){return !this.hided},SetVisible:function(k,l){l=l||false;if(k){this.Show(l)}else{this.Hide()}},Show:function(l){if(l==undefined){l=false}this.hided=false;this.ShowVideo();if(this.eboardControlPanel){var k=document.getElementById("eBoardControlPanel");if(k){main.ShowEBoardControlPanel()}}if(l){this.Resume();return}},Hide:function(k){if(k==undefined){k=true}this.hided=true;this.HideVideo();if(k){this.Stop()}else{this.Pause()}if(null==this.eboardControlPanel){return}var l=document.getElementById("eBoardControlPanel");if(l){main.HideEBoardControlPanel()}},ShowVideo:function(){if(this.videoPlayer&&this.videoPlayer.videoDisplay){if(false==main.Contains(this.videoPlayer.divDisplay)){main.Draw(this.videoPlayer)}}},HideVideo:function(){if(this.videoPlayer&&this.videoPlayer.videoDisplay){if(main.Contains(this.videoPlayer.divDisplay)){this.videoPlayer.Pause();main.Clear(this.videoPlayer)}}},PauseVideo:function(){if(this.videoPlayer&&this.videoPlayer.videoDisplay){this.videoPlayer.Pause()}},StopVideo:function(){if(this.videoPlayer&&this.videoPlayer.videoDisplay){this.videoPlayer.Stop()}},ResumeVideo:function(){if(this.videoPlayer&&this.videoPlayer.videoDisplay){this.videoPlayer.Play()}},SetPosVideo:function(k){if(this.videoPlayer&&this.videoPlayer.videoDisplay&&this.bSetPos){this.videoPlayer.setPlayheadTime(k);this.nJumpTime=k}},GetFullScreenClicked:function(){if(this.videoPlayer&&this.videoPlayer.videoDisplay){return this.videoPlayer.bFullScreenClicked}return false},SetFullScreenClicked:function(l){var k=this.GetVideoDisplay();if(k.videoDisplay.webkitRequestFullScreen){k.videoDisplay.webkitRequestFullScreen()}if(k.videoDisplay.mozRequestFullScreen){k.videoDisplay.mozRequestFullScreen()}}};return g});